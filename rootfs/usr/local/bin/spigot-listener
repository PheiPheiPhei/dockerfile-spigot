#!/bin/bash

set -euo pipefail

source /usr/local/etc/spigot.conf
source /usr/local/lib/async-runner

function before_stop() {
    ABORTED=yes
}

function after_stop() {
    if [ -z "${ABORTED:-}" ]
    then
        echo-pass "Connected"
    else
        echo-fail "Not connected"
        exit 1
    fi
}

echo-info "Waiting for connect..."
start nc -l -p "${SERVER_PORT}" -e true
wait_for_stop
